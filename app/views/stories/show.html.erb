<div class="story-show-container">
  <!-- D√©tails de l'histoire -->
  <div class="story-details card-story-show">
      <p><strong>Tags:</strong>
        <% @story.tags.each do |tag| %>
          <span class="badge badge-info"><%= tag.name %></span>
        <% end %>
      </p>
    <div class="story-header">
      <% if @story.cover_image.attached? %>
        <%= image_tag url_for(@story.cover_image), class: "story-cover-large" %>
      <% end %>
      <div class="story-info">
        <h1 class="story-title"><%= @story.title %></h1>
        <p class="story-description"><%= @story.description %></p>
        <% if current_user == @story.user %>
          <div class="story-actions">
            <%= link_to '‚úèÔ∏è Editer', edit_story_path(@story), class: 'btn btn-edit' %>
            <%= button_to 'üóëÔ∏è Supprimer', @story, method: :delete, data: { confirm: 'Es-tu s√ªr ?' }, class: 'btn btn-danger' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div>
    <% if @story.cover_image_url.present? %>
      <%= image_tag @story.cover_image_url, class: "story-show-img" %>
    <% else %>
      <%= image_tag("default.jpg", alt: "Couverture de #{@story.title}", class: "story-show-img") %>
    <% end %>
  </div>

  <!-- Liste des chapitres -->
  <div class="chapters-section card">
    <h2 class="section-title">Chapitres</h2>
    <div class="chapter-grid">
      <% @story.chapters.order(:position).each do |chapter| %>
        <div class="chapter-card">
          <div class="chapter-header">
            <h3 class="chapter-title">
              <%= link_to "Chapitre #{chapter.position}", story_chapter_path(@story, chapter.position) %>
            </h3>
          </div>
          <p class="chapter-excerpt"><%= truncate(chapter.content.to_plain_text, length: 100) %></p>
        </div>
      <% end %>
    </div>
    <% if current_user == @story.user %>
      <%= link_to '‚ûï Ajouter un chapitre', new_story_chapter_path(@story), class: 'btn btn-primary add-chapter-btn' %>
    <% end %>
  </div>

  <!-- Commentaires -->
  <% unless current_user == @story.user %>
    <div class="comments-section card">
      <h2>Commentaires</h2>
      <%= render 'comments/form', story: @story %>

      <ul class="comments-list">
        <% @story.comments.each do |comment| %>
          <li class="comment-card">
            <div class="comment-header">
              <strong><%= comment.user.username %>:</strong>
              <% if current_user == comment.user %>
                <%= button_to 'üóëÔ∏è Supprimer', story_comment_path(@story, comment), method: :delete, data: { confirm: 'Es-tu s√ªr ?', turbo: false }, class: 'btn btn-danger btn-sm' %>
              <% end %>
            </div>
            <p class="comment-content"><%= comment.content %></p>
          </li>
        <% end %>
      </ul>
    </div>

  <!-- Likes -->
  <div class="likes-section card">
    <h2>‚ù§Ô∏è Likes</h2>
    <% if current_user %>
      <% if @story.likes.exists?(user: current_user) %>
        <%= button_to '‚ù§Ô∏è Ne plus aimer', story_unlike_path(@story), method: :delete, data: { turbo: false }, class: 'btn btn-danger' %>
      <% else %>
        <%= button_to '‚ù§Ô∏è Aimer', story_like_path(@story), method: :post, data: { turbo: false }, class: 'btn btn-primary' %>
      <% end %>
    <% end %>
  </div>
  <% end %>

  <div class="back-link">
    <%= link_to 'Retour aux histoires', stories_path, class: 'btn btn-secondary' %>
  </div>
</div>
