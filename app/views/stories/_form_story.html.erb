<%= form_with(model: @story, local: true, class: 'story-form') do |form| %>
  <div class="form-group">
    <%= form.label :title, "Titre de l'histoire", class: 'form-label' %>
    <%= form.text_field :title, class: 'form-control input-field' %>
  </div>

  <div class="form-group">
    <%= form.label :description, "Description", class: 'form-label', for: "description" %>
<%= form.text_area :description, maxlength: 500, class: 'form-control input-field-desc', id: 'description' %>
<p id="charCount"></p>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var textarea = document.getElementById('description');
    var charCount = document.getElementById('charCount');

    // Fonction pour mettre à jour le compteur de caractères
    function updateCharCount() {
      var remaining = 500 - textarea.value.length;
      charCount.textContent = remaining + ' caractères restants';
    }

    // Mettre à jour le compteur au chargement de la page (en cas de texte préexistant)
    updateCharCount();

    // Mettre à jour le compteur à chaque fois que l'utilisateur tape dans le champ
    textarea.addEventListener('input', updateCharCount);
  });

  // Ajoute un événement pour masquer les tags existants lors de l'analyse
    document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('.btn-analyze').addEventListener('click', function() {
    document.getElementById("existing-tags").style.display = 'none';
  });
});
</script>

  <!-- Bouton pour analyser l'histoire -->
  <div class="form-group">
    <%= link_to "Analyser l'histoire", analyze_story_path(@story), remote: true, method: :post, class: 'btn btn-outline-primary btn-analyze' %>
  </div>

  <div id="suggested-tags" class="form-group">
  <!-- Les tags suggérés apparaîtront ici -->
</div>

  <!-- Tags suggérés -->
  <div id="suggested-tags" class="form-group">
    <% if @suggested_tags.present? %>
      <h4>Tags suggérés :</h4>
      <div class="suggested-tags-container">
        <% @suggested_tags.each do |tag| %>
          <div class="form-check">
            <%= check_box_tag "story[tags][]", tag, false, class: 'form-check-input' %>
            <%= label_tag "story_tags_#{tag}", tag, class: 'form-check-label' %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>


  <div id="existing-tags" class="form-group">
  <%= form.label :tag_ids, "Tags" %>
  <%= form.collection_select :tag_ids, Tag.all, :id, :name, {}, { multiple: true, class: "form-control", name: "story[tag_ids][]", id: "story_tag_ids" } %>
  </div>

  <div class="form-group">
    <%= form.label :category_id, "Choisir une catégorie", class: 'form-label' %>
    <%= form.collection_select :category_id, Category.all, :id, :name, prompt: "Sélectionnez une catégorie", class: "form-control input-field" %>
  </div>

  <div class="form-group">
    <%= form.submit "Mettre à jour l'histoire", class: 'btn btn-primary cta-button' %>
  </div>

  <div class="field">
    <%= form.label :cover_image_url, "Lien de l'image de couverture" %><br>
    <%= form.text_field :cover_image_url, placeholder: "https://exemple.com/mon-image.jpg" %>
  </div>

  <% if @story.cover_image_url.present? %>
    <div class="cover-preview">
      <p>Image actuelle :</p>
      <%= image_tag @story.cover_image_url, class: "story-cover-edit" %>
    </div>
  <% end %>
<% end %>

<div class="form-group">
  <%= link_to 'Retour aux histoires', stories_path, class: 'btn btn-secondary cta-button' %>
</div>
